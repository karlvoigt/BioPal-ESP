# Impedance Comparison GUI

Interactive GUI tool for comparing PalmSens PS Trace measurements with BioPal ESP32 measurements.

## Features

- **Load and compare** PalmSens and BioPal CSV files
- **Bode plot visualization** showing magnitude and phase
- **Error analysis** with percentage error plots
- **Statistical metrics** including mean, standard deviation, and max error
- **Interactive plots** with zoom, pan, and save capabilities

## Installation

Install dependencies:
```bash
pip install -r requirements.txt
```

This installs:
- `matplotlib` - For plotting
- `numpy` - For numerical calculations
- `tkinter` - Usually included with Python

## Usage

### Launch the Tool

**Command line mode** (recommended):
```bash
python impedance_comparison_gui.py <palmsens_csv> <biopal_csv>
```

**Interactive mode**:
```bash
python impedance_comparison_gui.py
```
Then enter file paths when prompted.

### Steps to Compare Data

1. Run the script with both CSV file paths
2. The tool will:
   - Load and parse both files
   - Show data ranges and any issues found
   - Calculate percentage errors
   - Display comparison plots

3. **Analyze Results**: The plots show:
   - Top left: Impedance magnitude comparison (Log-Log scale)
   - Top right: Phase comparison (Semi-log scale)
   - Bottom left: Magnitude percentage error vs frequency
   - Bottom right: Phase percentage error vs frequency

## CSV File Formats

### PalmSens PS Trace CSV Format

Export from PS Trace software. Typical format:
```
File date:,2025-10-09 14:55:31
Measurement:,Impedance Spectroscopy
...
freq / Hz,neg. Phase / °,Idc / uA,Z / Ohm,Z' / Ohm,Z'' / Ohm,Cs / F,
1.000,52.595,0.052,1.434E+04,8.712E+03,1.139E+04,7.158E+04,
2.000,48.511,0.052,9.813E+03,6.501E+03,7.351E+03,9.237E+04,
...
```

### BioPal CSV Format

Generated by BioPal ESP32 system:
```
DUT,Frequency_Hz,Magnitude_Ohms,Phase_Deg
1,1.000,14342.3,52.595
1,2.000,9812.82,48.511
...
```

## Error Calculation

Percentage error is calculated as:
```
Error (%) = ((BioPal - PalmSens) / PalmSens) × 100
```

- **Positive error**: BioPal reads higher than PalmSens
- **Negative error**: BioPal reads lower than PalmSens

## Features of the Plots

### Interactive Controls
- **Zoom**: Use the zoom button in toolbar or scroll wheel
- **Pan**: Click and drag to move around
- **Home**: Reset view to original
- **Save**: Export plots as PNG, PDF, SVG, etc.

### Statistics Box
Each error plot shows:
- **Mean**: Average error across all frequencies
- **Std**: Standard deviation of error
- **Max**: Maximum absolute error

## Data Validation

The tool automatically validates and cleans the data:

### BioPal CSV Validation
- **Skips invalid entries**: Rows with frequency ≤ 0 or magnitude ≤ 0 are automatically skipped
- **Phase normalization**: Phase values outside -180° to +180° are normalized
  - Example: -272.94° becomes 87.06°
  - Example: 281.21° becomes -78.79°
- **Debug output**: Shows data ranges and number of skipped points

### Console Output Example
```
Loading BioPal CSV: PBS 1x BioPal DUT 1_1.csv
  ✓ Loaded 36 data points
  ⚠ Skipped 2 invalid data points (freq=0 or magnitude=0)
  Frequency range: 1.0 Hz to 62500.0 Hz
  Magnitude range: 5.9 Ω to 37874.7 Ω
  Phase range: -173.65° to 87.06°
```

## Troubleshooting

### File Loading Errors

**PalmSens CSV not recognized:**
- Make sure you exported the data from PS Trace as CSV
- Check that the file contains "freq" and "Hz" in the header
- File might be UTF-16 encoded - the tool handles this automatically

**BioPal CSV not recognized:**
- Verify the CSV has the header: `DUT,Frequency_Hz,Magnitude_Ohms,Phase_Deg`
- Check that data rows have 4 comma-separated values

### No Overlapping Frequency Range

If you get an error about insufficient overlapping frequencies:
- Check that both measurements cover similar frequency ranges
- The comparison only works for frequencies present in both datasets
- Try using measurements with the same frequency sweep settings

### GUI Not Launching

**On macOS:**
If you get tkinter errors, make sure you're using a Python version with Tk support:
```bash
python3 --version
python3 -m tkinter  # Should open a test window
```

**On Linux:**
Install tkinter:
```bash
sudo apt-get install python3-tk  # Debian/Ubuntu
sudo yum install python3-tkinter  # Fedora/RHEL
```

## Example Workflow

1. Run impedance measurement with PalmSens device
2. Export data from PS Trace as CSV
3. Run same measurement with BioPal ESP32
4. Save BioPal data using the data capture tool
5. Load both files in this comparison GUI
6. Analyze the differences and validate BioPal accuracy

## Tips

- Use the **same DUT** for both PalmSens and BioPal measurements
- Perform measurements **close in time** to avoid drift
- Keep **environmental conditions** similar (temperature, humidity)
- Use the **same frequency range** and points for best comparison
- The toolbar's **save** button can export high-quality plots for reports
